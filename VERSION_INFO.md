# ç‰ˆæœ¬ä¿¡æ¯åŠŸèƒ½è¯´æ˜

## âœ¨ æ–°å¢åŠŸèƒ½

sql-diff ç°åœ¨æ”¯æŒå®Œæ•´çš„ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½ï¼Œæä¾›å¤šç§æ–¹å¼æŸ¥çœ‹ç‰ˆæœ¬ï¼š

### 1. `--version` æ ‡å¿—ï¼ˆç®€æ´è¾“å‡ºï¼‰

```bash
$ sql-diff --version
v1.0.2
```

**ç‰¹ç‚¹**ï¼š
- âœ… åªæ˜¾ç¤ºç‰ˆæœ¬å·ï¼Œé€‚åˆè„šæœ¬ä½¿ç”¨
- âœ… ç¬¦åˆ CLI å·¥å…·æ ‡å‡†
- âœ… è¾“å‡ºå¹²å‡€ï¼Œæ˜“äºè§£æ

### 2. `-v` æ ‡å¿—ï¼ˆCobra é»˜è®¤ï¼‰

```bash
$ sql-diff -v
v1.0.2
```

**è¯´æ˜**ï¼š
- Cobra æ¡†æ¶é»˜è®¤æ”¯æŒ `-v` ä½œä¸º `--version` çš„çŸ­æ ‡å¿—
- ä¸ `--version` è¾“å‡ºç›¸åŒ

### 3. `version` å‘½ä»¤ï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰

```bash
$ sql-diff version
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       SQL-Diff ç‰ˆæœ¬ä¿¡æ¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç‰ˆæœ¬å·:     v1.0.2
æ„å»ºæ—¶é—´:   2025-10-24_06:00:47
Gitæäº¤:    2e857fd

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ˜¾ç¤ºå®Œæ•´çš„ç‰ˆæœ¬ä¿¡æ¯
- âœ… åŒ…å«æ„å»ºæ—¶é—´å’Œ Git æäº¤å“ˆå¸Œ
- âœ… ç¾è§‚çš„å½©è‰²è¾“å‡º
- âœ… é€‚åˆè°ƒè¯•å’Œé—®é¢˜æŠ¥å‘Š

### 4. `v` å‘½ä»¤ï¼ˆåˆ«åï¼‰

```bash
$ sql-diff v
# è¾“å‡ºåŒ version å‘½ä»¤
```

**ç‰¹ç‚¹**ï¼š
- âœ… `version` å‘½ä»¤çš„å¿«æ·åˆ«å
- âœ… æ›´å¿«é€Ÿçš„è¾“å…¥
- âœ… æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

## ğŸ“Š å¯¹æ¯”

| å‘½ä»¤ | è¾“å‡ºå†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|
| `--version` | ä»…ç‰ˆæœ¬å· | è„šæœ¬ä½¿ç”¨ã€ç‰ˆæœ¬æ£€æŸ¥ |
| `-v` | ä»…ç‰ˆæœ¬å· | åŒ `--version` |
| `version` | è¯¦ç»†ä¿¡æ¯ | è°ƒè¯•ã€é—®é¢˜æŠ¥å‘Šã€äº†è§£æ„å»ºä¿¡æ¯ |
| `v` | è¯¦ç»†ä¿¡æ¯ | å¿«é€ŸæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ |

## ğŸ”§ æŠ€æœ¯å®ç°

### ç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥

ç‰ˆæœ¬ä¿¡æ¯é€šè¿‡ç¼–è¯‘æ—¶çš„ `-ldflags` æ³¨å…¥ï¼š

```makefile
# Makefile
LDFLAGS=-ldflags "-s -w \
  -X main.Version=$(VERSION) \
  -X main.BuildTime=$(BUILD_TIME) \
  -X main.GitCommit=$(GIT_COMMIT)"
```

### å˜é‡å®šä¹‰

åœ¨ `cmd/sql-diff/main.go` ä¸­å®šä¹‰ï¼š

```go
var (
    Version   = "dev"      // ç‰ˆæœ¬å·
    BuildTime = "unknown"  // æ„å»ºæ—¶é—´
    GitCommit = "unknown"  // Git æäº¤å“ˆå¸Œ
)
```

### ä¼ é€’ç»™ cmd åŒ…

```go
func main() {
    cmd.SetVersion(Version, BuildTime, GitCommit)
    cmd.Execute()
}
```

### åœ¨ cmd åŒ…ä¸­ä½¿ç”¨

```go
// internal/cmd/root.go
var (
    version   = "dev"
    buildTime = "unknown"
    gitCommit = "unknown"
)

func SetVersion(v, bt, gc string) {
    if v != "" {
        version = v
        rootCmd.Version = v  // æ›´æ–° rootCmd
    }
    if bt != "" {
        buildTime = bt
    }
    if gc != "" {
        gitCommit = gc
    }
}
```

### version å‘½ä»¤å®ç°

```go
// internal/cmd/version.go
var versionCmd = &cobra.Command{
    Use:     "version",
    Aliases: []string{"v"},
    Short:   "æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯",
    Run: func(cmd *cobra.Command, args []string) {
        printVersion()
    },
}

func printVersion() {
    // å½©è‰²è¾“å‡ºè¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯
    fmt.Printf("ç‰ˆæœ¬å·:     %s\n", version)
    fmt.Printf("æ„å»ºæ—¶é—´:   %s\n", buildTime)
    fmt.Printf("Gitæäº¤:    %s\n", gitCommit)
}
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### å¼€å‘é˜¶æ®µ

```bash
# ä½¿ç”¨ make build ç¼–è¯‘ï¼ˆè‡ªåŠ¨æ³¨å…¥ç‰ˆæœ¬ä¿¡æ¯ï¼‰
$ make build
âœ“ ç¼–è¯‘å®Œæˆ: bin/sql-diff
âœ“ ç‰ˆæœ¬: v1.0.2-7-g2e857fd-dirty

# æŸ¥çœ‹ç‰ˆæœ¬
$ ./bin/sql-diff version
ç‰ˆæœ¬å·:     v1.0.2-7-g2e857fd-dirty
æ„å»ºæ—¶é—´:   2025-10-24_06:00:47
Gitæäº¤:    2e857fd
```

**è¯´æ˜**ï¼š
- `v1.0.2`ï¼šæœ€è¿‘çš„ tag
- `-7-g2e857fd`ï¼šè·ç¦» tag æœ‰ 7 ä¸ªæäº¤
- `-dirty`ï¼šæœ‰æœªæäº¤çš„ä¿®æ”¹

### ç”Ÿäº§ç‰ˆæœ¬

```bash
# å‘å¸ƒç‰ˆæœ¬ï¼ˆé€šè¿‡ tag è§¦å‘ï¼‰
$ git tag v1.1.0
$ git push origin v1.1.0

# GitHub Actions è‡ªåŠ¨æ„å»º
# ç”¨æˆ·å®‰è£…åæŸ¥çœ‹ç‰ˆæœ¬
$ sql-diff --version
v1.1.0
```

### è„šæœ¬ä¸­ä½¿ç”¨

```bash
#!/bin/bash

# æ£€æŸ¥ sql-diff ç‰ˆæœ¬
VERSION=$(sql-diff --version)

if [[ "$VERSION" < "v1.0.0" ]]; then
    echo "éœ€è¦ sql-diff >= v1.0.0"
    exit 1
fi

echo "å½“å‰ç‰ˆæœ¬: $VERSION"
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-10-24

**æ–°å¢**ï¼š
- âœ… æ·»åŠ  `--version` å’Œ `-v` æ ‡å¿—
- âœ… æ·»åŠ  `version` å‘½ä»¤
- âœ… æ·»åŠ  `v` å‘½ä»¤åˆ«å
- âœ… æ”¯æŒæ„å»ºæ—¶æ³¨å…¥ç‰ˆæœ¬ä¿¡æ¯
- âœ… ç¾åŒ–ç‰ˆæœ¬ä¿¡æ¯è¾“å‡º

**æŠ€æœ¯ç»†èŠ‚**ï¼š
- ä½¿ç”¨ Cobra çš„ `Version` å­—æ®µæ”¯æŒ `--version`
- è‡ªå®šä¹‰ `SetVersionTemplate` ç®€åŒ–è¾“å‡º
- åˆ›å»ºç‹¬ç«‹çš„ `version` å‘½ä»¤æä¾›è¯¦ç»†ä¿¡æ¯

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ç¼–è¯‘æ³¨å…¥çš„ç‰ˆæœ¬ä¿¡æ¯

```bash
# æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å­—ç¬¦ä¸²
$ strings bin/sql-diff | grep -E "v[0-9]+\.[0-9]+\.[0-9]+"
```

### éªŒè¯ç‰ˆæœ¬ä¿¡æ¯æ˜¯å¦æ­£ç¡®æ³¨å…¥

```bash
# ä½¿ç”¨ make build ç¼–è¯‘
$ make build

# æ£€æŸ¥æ‰€æœ‰ç‰ˆæœ¬ç›¸å…³å‘½ä»¤
$ ./bin/sql-diff --version   # åº”æ˜¾ç¤ºç‰ˆæœ¬å·
$ ./bin/sql-diff version     # åº”æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
```

## ğŸš€ æœ€ä½³å®è·µ

1. **å¼€å‘æ—¶**ï¼šä½¿ç”¨ `make build` ç¼–è¯‘ï¼Œè‡ªåŠ¨æ³¨å…¥ Git ä¿¡æ¯
2. **å‘å¸ƒæ—¶**ï¼šé€šè¿‡ tag è§¦å‘ CI/CDï¼Œç¡®ä¿ç‰ˆæœ¬å·ä¸€è‡´
3. **è„šæœ¬ä¸­**ï¼šä½¿ç”¨ `--version` è·å–ç®€æ´è¾“å‡º
4. **è°ƒè¯•æ—¶**ï¼šä½¿ç”¨ `version` å‘½ä»¤æŸ¥çœ‹å®Œæ•´ä¿¡æ¯
5. **é—®é¢˜æŠ¥å‘Š**ï¼šæä¾› `sql-diff version` çš„å®Œæ•´è¾“å‡º

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `cmd/sql-diff/main.go` - ç‰ˆæœ¬å˜é‡å®šä¹‰
- `internal/cmd/root.go` - ç‰ˆæœ¬ä¿¡æ¯è®¾ç½®å’Œ rootCmd é…ç½®
- `internal/cmd/version.go` - version å‘½ä»¤å®ç°
- `Makefile` - ç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥é…ç½®

## ğŸ‰ æ€»ç»“

ç°åœ¨ sql-diff æ‹¥æœ‰å®Œæ•´çš„ç‰ˆæœ¬ä¿¡æ¯åŠŸèƒ½ï¼š

- âœ… **æ ‡å‡†åŒ–**ï¼šç¬¦åˆ CLI å·¥å…·çš„æ ‡å‡†å®è·µ
- âœ… **çµæ´»æ€§**ï¼šæä¾›ç®€æ´å’Œè¯¦ç»†ä¸¤ç§è¾“å‡ºæ–¹å¼
- âœ… **æ˜“ç”¨æ€§**ï¼šæ”¯æŒå¤šç§å‘½ä»¤å’Œåˆ«å
- âœ… **å¯è¿½æº¯**ï¼šåŒ…å«æ„å»ºæ—¶é—´å’Œ Git æäº¤ä¿¡æ¯
- âœ… **è‡ªåŠ¨åŒ–**ï¼šé€šè¿‡ Makefile å’Œ CI/CD è‡ªåŠ¨æ³¨å…¥

è¿™ä½¿å¾—ç‰ˆæœ¬ç®¡ç†ã€é—®é¢˜è°ƒè¯•å’Œç”¨æˆ·æ”¯æŒéƒ½å˜å¾—æ›´åŠ å®¹æ˜“ï¼
