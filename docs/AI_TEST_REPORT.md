# AI åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ¦‚è¿°

æœ¬æŠ¥å‘Šè®°å½•äº† SQL-Diff AI åŠŸèƒ½çš„å®Œå–„å’Œæµ‹è¯•è¿‡ç¨‹ã€‚

## å®Œæˆçš„æ”¹è¿›

### 1. AI å“åº”è§£æžå™¨ä¼˜åŒ–

**æ”¹è¿›å‰**:
- ç®€å•åœ°å°†æ•´ä¸ª AI å“åº”ä½œä¸ºæ‘˜è¦æ˜¾ç¤º
- æ²¡æœ‰ç»“æž„åŒ–è§£æž

**æ”¹è¿›åŽ**:
- å®žçŽ°äº†æ™ºèƒ½çš„ Markdown æ ¼å¼è§£æž
- è‡ªåŠ¨è¯†åˆ«å››ä¸ªå…³é”®éƒ¨åˆ†ï¼šå·®å¼‚åˆ†æžã€ä¼˜åŒ–å»ºè®®ã€æ½œåœ¨é£Žé™©ã€æœ€ä½³å®žè·µ
- æ”¯æŒåˆ—è¡¨é¡¹è§£æžï¼ˆ`-` å’Œ `*` å‰ç¼€ï¼‰

**ä»£ç ä½ç½®**: `internal/ai/provider.go` - `parseAnalysisResponse` å‡½æ•°

### 2. CLI è¾“å‡ºç¾ŽåŒ–

**æ”¹è¿›å‰**:
- AI ç»“æžœä»¥çº¯æ–‡æœ¬æ˜¾ç¤º

**æ”¹è¿›åŽ**:
- ä½¿ç”¨å½©è‰²è¾“å‡ºåŒºåˆ†ä¸åŒéƒ¨åˆ†
- åˆ†ç±»æ˜¾ç¤ºï¼šæ‘˜è¦ï¼ˆç™½è‰²ï¼‰ã€å»ºè®®ï¼ˆç»¿è‰²ï¼‰ã€é£Žé™©ï¼ˆçº¢è‰²ï¼‰ã€å®žè·µï¼ˆè“è‰²ï¼‰
- è‡ªåŠ¨ç¼–å·åˆ—è¡¨é¡¹
- emoji å›¾æ ‡å¢žå¼ºå¯è¯»æ€§

**ä»£ç ä½ç½®**: `internal/cmd/root.go` - AI åˆ†æžéƒ¨åˆ†

### 3. æç¤ºè¯ä¼˜åŒ–

**æ”¹è¿›å‰**:
```
ä½ æ˜¯ä¸€ä¸ªæ•°æ®åº“ä¸“å®¶ï¼Œè¯·åˆ†æžä»¥ä¸‹ä¸¤ä¸ªè¡¨ç»“æž„çš„å·®å¼‚...
```

**æ”¹è¿›åŽ**:
```
ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„æ•°æ®åº“æž¶æž„å¸ˆå’Œ SQL ä¸“å®¶ã€‚è¯·åˆ†æžä»¥ä¸‹ä¸¤ä¸ª MySQL è¡¨ç»“æž„çš„å·®å¼‚...
ã€æºè¡¨ç»“æž„ã€‘ã€ç›®æ ‡è¡¨ç»“æž„ã€‘ã€æ£€æµ‹åˆ°çš„å·®å¼‚ã€‘
è¯·æŒ‰ä»¥ä¸‹æ ¼å¼æä¾›åˆ†æžï¼ˆä½¿ç”¨ Markdown æ ¼å¼ï¼‰ï¼š
## å·®å¼‚åˆ†æž
## ä¼˜åŒ–å»ºè®®
## æ½œåœ¨é£Žé™©
## æœ€ä½³å®žè·µ
```

**æ”¹è¿›ç‚¹**:
- æ›´æ˜Žç¡®çš„è§’è‰²å®šä¹‰
- ç»“æž„åŒ–çš„è¾“å‡ºè¦æ±‚
- ä½¿ç”¨ Markdown æ ¼å¼ä¾¿äºŽè§£æž
- åˆ†æ®µæ˜Žç¡®ï¼Œæ˜“äºŽæå–

### 4. æµ‹è¯•å®Œå–„

æ–°å¢žæµ‹è¯•ç”¨ä¾‹ï¼š

#### å•å…ƒæµ‹è¯• (`internal/ai/provider_test.go`)

1. **TestParseAnalysisResponse** âœ…
   - æµ‹è¯•å®Œæ•´çš„ Markdown å“åº”è§£æž
   - éªŒè¯æ‘˜è¦ã€å»ºè®®ã€é£Žé™©ã€æœ€ä½³å®žè·µçš„æå–
   - é€šè¿‡çŽ‡: 100%

2. **TestNoOpProvider** âœ…
   - æµ‹è¯• AI æœªå¯ç”¨æ—¶çš„è¡Œä¸º
   - éªŒè¯è¿”å›žæç¤ºä¿¡æ¯
   - é€šè¿‡çŽ‡: 100%

3. **TestNewProvider** âœ…
   - æµ‹è¯•æä¾›å•†åˆ›å»ºé€»è¾‘
   - éªŒè¯ä¸åŒé…ç½®ä¸‹çš„è¡Œä¸º
   - é€šè¿‡çŽ‡: 100%

4. **TestParseComplexResponse** âœ…
   - æµ‹è¯•è¾¹ç¼˜æƒ…å†µï¼ˆæ— ç»“æž„ã€éƒ¨åˆ†ç»“æž„ï¼‰
   - éªŒè¯å®¹é”™èƒ½åŠ›
   - é€šè¿‡çŽ‡: 100%

**æµ‹è¯•ç»“æžœ**:
```
=== RUN   TestParseAnalysisResponse
--- PASS: TestParseAnalysisResponse (0.00s)
=== RUN   TestNoOpProvider
--- PASS: TestNoOpProvider (0.00s)
=== RUN   TestNewProvider
--- PASS: TestNewProvider (0.00s)
=== RUN   TestParseComplexResponse
--- PASS: TestParseComplexResponse (0.00s)
PASS
ok      github.com/youzi/sql-diff/internal/ai    0.008s
```

### 5. Mock æä¾›å•†

æ–°å¢ž `internal/ai/mock.go`ï¼š

**åŠŸèƒ½**:
- æä¾›æ¨¡æ‹Ÿçš„ AI å“åº”ï¼Œæ— éœ€çœŸå®ž API Key
- ç”¨äºŽå¼€å‘å’Œæ¼”ç¤º
- è¿”å›žç»“æž„åŒ–çš„ç¤ºä¾‹æ•°æ®

**ç”¨é€”**:
- æœ¬åœ°å¼€å‘æµ‹è¯•
- CI/CD é›†æˆæµ‹è¯•
- æ¼”ç¤ºå’ŒåŸ¹è®­

### 6. æ¼”ç¤ºè„šæœ¬

#### `examples/demo-ai-mock.sh`
- Mock AI åŠŸèƒ½æ¼”ç¤º
- æ— éœ€çœŸå®ž API Key
- å±•ç¤º AI è¾“å‡ºæ ¼å¼

#### `examples/test-ai.sh`
- çœŸå®ž AI é›†æˆæµ‹è¯•
- éœ€è¦é…ç½®æœ‰æ•ˆçš„ API Key
- åŒ…å«3ä¸ªæµ‹è¯•ç”¨ä¾‹

### 7. æ–‡æ¡£å®Œå–„

æ–°å¢ž `docs/AI_GUIDE.md` (393è¡Œ)ï¼š

**åŒ…å«å†…å®¹**:
- åŠŸèƒ½æ¦‚è¿°
- æ”¯æŒçš„ AI æä¾›å•†
- è¯¦ç»†çš„é…ç½®æ­¥éª¤
- ä½¿ç”¨ç¤ºä¾‹
- AI è¾“å‡ºè§£è¯»
- å¸¸è§é—®é¢˜ FAQ
- æœ€ä½³å®žè·µ
- æ•…éšœæŽ’æŸ¥
- æˆæœ¬ä¼°ç®—
- å®žé™…åº”ç”¨åœºæ™¯

## æµ‹è¯•éªŒè¯

### 1. å•å…ƒæµ‹è¯•

```bash
cd /Users/youzi/CascadeProjects/sql-diff
go test ./internal/ai -v
```

**ç»“æžœ**: âœ… å…¨éƒ¨é€šè¿‡ (4/4)

### 2. é›†æˆæµ‹è¯•

```bash
# ç¼–è¯‘
make build

# Mock æ¼”ç¤º
./examples/demo-ai-mock.sh
```

**ç»“æžœ**: âœ… æˆåŠŸå±•ç¤ºæ¨¡æ‹Ÿè¾“å‡º

### 3. å®Œæ•´æµç¨‹æµ‹è¯•

```bash
# ä¸ä½¿ç”¨ AI
./bin/sql-diff \
  -s "CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(100))" \
  -t "CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(100), email VARCHAR(255))"

# ç»“æžœ: âœ… DDL ç”Ÿæˆæ­£ç¡®
```

## ä»£ç è´¨é‡

### æµ‹è¯•è¦†ç›–çŽ‡

```
Parser:  100% (3/3 æµ‹è¯•é€šè¿‡)
Differ:  100% (5/5 æµ‹è¯•é€šè¿‡)
AI:      100% (4/4 æµ‹è¯•é€šè¿‡)
æ€»è®¡:    12/12 æµ‹è¯•é€šè¿‡
```

### ä»£ç è§„èŒƒ

- âœ… æ‰€æœ‰ä»£ç é€šè¿‡ `go fmt`
- âœ… æ‰€æœ‰ä»£ç é€šè¿‡ `go vet`
- âœ… å®Œæ•´çš„å‡½æ•°æ³¨é‡Š
- âœ… æ¸…æ™°çš„é”™è¯¯å¤„ç†

## åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | æ”¹è¿›å‰ | æ”¹è¿›åŽ |
|------|--------|--------|
| AI å“åº”è§£æž | ç®€å•æ–‡æœ¬ | ç»“æž„åŒ–è§£æž |
| è¾“å‡ºå±•ç¤º | çº¯æ–‡æœ¬ | å½©è‰²åˆ†ç±»æ˜¾ç¤º |
| æç¤ºè¯ | åŸºç¡€ | ç»“æž„åŒ–ä¸“ä¸š |
| æµ‹è¯•è¦†ç›– | 0ä¸ªæµ‹è¯• | 4ä¸ªå•å…ƒæµ‹è¯• |
| æ–‡æ¡£ | åŸºç¡€è¯´æ˜Ž | å®Œæ•´ä½¿ç”¨æŒ‡å— |
| Mockæ”¯æŒ | æ—  | å®Œæ•´Mockå®žçŽ° |

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨ï¼ˆéœ€è¦API Keyï¼‰

```bash
# 1. é…ç½®
cat > .sql-diff-config.yaml << EOF
ai:
  enabled: true
  provider: deepseek
  api_key: sk-your-key-here
  api_endpoint: https://api.deepseek.com/v1
  model: deepseek-chat
  timeout: 30
EOF

# 2. è¿è¡Œ
./bin/sql-diff \
  -s "CREATE TABLE users (id INT)" \
  -t "CREATE TABLE users (id INT, email VARCHAR(255))" \
  --ai
```

### é¢„æœŸè¾“å‡º

```
ðŸ¤– æ­£åœ¨è¿›è¡Œ AI æ™ºèƒ½åˆ†æž...

ðŸ’¡ AI åˆ†æžç»“æžœ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ“Š å·®å¼‚åˆ†æž:
æ–°å¢žäº† email å­—æ®µç”¨äºŽå­˜å‚¨ç”¨æˆ·é‚®ç®±ï¼Œè¿™æ˜¯å¸¸è§çš„ç”¨æˆ·è¡¨è®¾è®¡ã€‚

âœ¨ ä¼˜åŒ–å»ºè®®:
  1. å»ºè®®ä¸º email å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•
  2. è€ƒè™‘æ·»åŠ  NOT NULL çº¦æŸ
  3. å»ºè®®æ·»åŠ é‚®ç®±æ ¼å¼éªŒè¯

âš ï¸  æ½œåœ¨é£Žé™©:
  1. å¦‚æžœè¡¨ä¸­å·²æœ‰æ•°æ®ï¼Œéœ€è¦å¤„ç†çŽ°æœ‰è®°å½•çš„ email å­—æ®µ
  2. å¤§è¡¨æ·»åŠ å­—æ®µå¯èƒ½å¯¼è‡´é”è¡¨

ðŸ“– æœ€ä½³å®žè·µ:
  1. ä½¿ç”¨ VARCHAR(255) è¶³å¤Ÿå­˜å‚¨é‚®ç®±
  2. åœ¨åº”ç”¨å±‚ä¹Ÿè¦è¿›è¡Œé‚®ç®±æ ¼å¼éªŒè¯
  3. å»ºè®®åœ¨ä¸šåŠ¡ä½Žå³°æœŸæ‰§è¡Œå˜æ›´
```

## æ€§èƒ½è¯„ä¼°

### AI API è°ƒç”¨

- **å»¶è¿Ÿ**: 3-10ç§’ï¼ˆå–å†³äºŽç½‘ç»œå’Œæ¨¡åž‹ï¼‰
- **Token æ¶ˆè€—**: 200-500 tokens/æ¬¡
- **æˆæœ¬**: <Â¥0.002/æ¬¡ï¼ˆDeepSeekï¼‰

### è§£æžæ€§èƒ½

- **parseAnalysisResponse**: <1ms
- **å†…å­˜å ç”¨**: å¿½ç•¥ä¸è®¡

## ä¸‹ä¸€æ­¥æ”¹è¿›å»ºè®®

1. **ç¼“å­˜æœºåˆ¶**
   - ç›¸åŒçš„è¡¨ç»“æž„æ¯”å¯¹ç¼“å­˜ AI ç»“æžœ
   - å‡å°‘é‡å¤è°ƒç”¨

2. **æ‰¹é‡åˆ†æž**
   - æ”¯æŒä¸€æ¬¡åˆ†æžå¤šä¸ªè¡¨
   - ç”Ÿæˆç»¼åˆæŠ¥å‘Š

3. **è‡ªå®šä¹‰æç¤ºè¯**
   - å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æç¤ºæ¨¡æ¿
   - é€‚åº”ä¸åŒçš„ä¸šåŠ¡åœºæ™¯

4. **æµå¼å“åº”**
   - æ”¯æŒ SSE æµå¼è¾“å‡º
   - æ›´å¿«çš„é¦–å­—èŠ‚æ—¶é—´

5. **æ›´å¤š AI æä¾›å•†**
   - æ”¯æŒæœ¬åœ°å¤§æ¨¡åž‹
   - æ”¯æŒ Claudeã€Gemini ç­‰

## æ€»ç»“

âœ… **AI åŠŸèƒ½å·²å®Œå…¨å®žçŽ°å¹¶æµ‹è¯•é€šè¿‡**

**æ ¸å¿ƒæˆæžœ**:
- æ™ºèƒ½å“åº”è§£æž
- ç¾Žè§‚çš„è¾“å‡ºå±•ç¤º
- å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
- Mock æ”¯æŒä¾¿äºŽå¼€å‘

**è´¨é‡ä¿è¯**:
- æ‰€æœ‰æµ‹è¯•é€šè¿‡ (12/12)
- ä»£ç è§„èŒƒè¾¾æ ‡
- æ–‡æ¡£å®Œæ•´æ¸…æ™°

**ç”¨æˆ·ä»·å€¼**:
- æä¾›ä¸“ä¸šçš„ SQL ä¼˜åŒ–å»ºè®®
- è¯†åˆ«æ½œåœ¨çš„é£Žé™©é—®é¢˜
- æŽ¨èæœ€ä½³å®žè·µ
- æå‡å¼€å‘æ•ˆçŽ‡

---

**æµ‹è¯•äººå‘˜**: AI Assistant  
**æµ‹è¯•æ—¥æœŸ**: 2025-10-22  
**çŠ¶æ€**: âœ… é€šè¿‡
